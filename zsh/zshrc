#!/usr/bin/env zsh

export EDITOR=nvim
export TERM=xterm-256color
export LC_ALL=en_US.UTF-8
export LANG=en_US.UTF-8
export PATH="/usr/local/sbin:$HOME/.dotfiles/etc/bin:$PATH"
export PATH="/Applications/Postgres.app/Contents/Versions/9.6/bin:$PATH"

# POWERLEVEL9K_LEFT_PROMPT_ELEMENTS=(user dir vcs rbenv rspec_stats newline)
# POWERLEVEL9K_RIGHT_PROMPT_ELEMENTS=(status root_indicator ip background_jobs history time)

# Prefer using emacs mode for zsh
bindkey -e

source ~/.zplugin/bin/zplugin.zsh

zplugin light zsh-users/zsh-completions
zplugin light zsh-users/zsh-history-substring-search
zplugin light zdharma/fast-syntax-highlighting
zplugin light zdharma/history-search-multi-word

zplugin ice wait"!0" atload'_zsh_autosuggest_start'
zplugin light zsh-users/zsh-autosuggestions

zplugin ice from"gh-r" as"program"
zplugin light junegunn/fzf-bin

zplugin light romkatv/powerlevel10k

zplugin ice "rupa/z" pick"z.sh"; zplugin light "rupa/z"
zplugin snippet OMZ::lib/history.zsh

zplugin ice as"completion"
zplugin snippet https://github.com/docker/cli/blob/master/contrib/completion/zsh/_docker

zplugin ice as"completion"
zplugin snippet https://github.com/docker/compose/blob/master/contrib/completion/zsh/_docker-compose

# Load my zsh dotfiles, aliases
files=( {00_aliases,10_options,20_functions}.zsh )
zplugin ice svn multisrc"\$files" pick"/dev/null"
zplugin light %HOME/.dotfiles/zsh/config

# Key bindings for zsh-history-substring-search
bindkey '^[[A' history-substring-search-up
bindkey '^[[B' history-substring-search-down
bindkey -M emacs '^P' history-substring-search-up
bindkey -M emacs '^N' history-substring-search-down
bindkey -M vicmd 'k' history-substring-search-up
bindkey -M vicmd 'j' history-substring-search-down

# https://carlosbecker.com/posts/speeding-up-zsh/
autoload -Uz compinit
if [ $(date +'%j') != $(stat -f '%Sm' -t '%j' ~/.zcompdump) ]; then
  compinit;
else
  compinit -C;
fi;

if [ -d "$HOME/.asdf" ]; then
  . "$HOME/.asdf/asdf.sh"
  . "$HOME/.asdf/completions/asdf.bash"
fi

if [ -d "$HOME/.rbenv" ]; then
  eval "$(rbenv init - --no-rehash)"
fi

if [ -d "$HOME/.jenv" ]; then
  eval "$(jenv init -)"
fi

# Timing App Terminal Support
if [ $ITERM_SESSION_ID ]; then
  DISABLE_AUTO_TITLE="true"
  echo -ne "\033]0; ${USER} @ ${HOST%%.*} : ${PWD/# $HOME/ ~} \007"
fi

precmd() {
  echo -ne "\033]0; ${USER} @ ${HOST%%.*} : ${PWD/# $HOME/ ~} \007"
}

if [ -f "$HOME/.zshrc.local" ]; then
  source "$HOME/.zshrc.local"
fi

# To customize prompt, run `p10k configure` or edit ~/.p10k.zsh.
[[ -f ~/.p10k.zsh ]] && source ~/.p10k.zsh

[ -f ~/.fzf.zsh ] && source ~/.fzf.zsh

[ -f ~/.bashhub/bashhub.zsh ] && source ~/.bashhub/bashhub.zsh
